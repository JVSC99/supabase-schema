import{o as x,c as S,a as y,d as W,t as Ye,b as le,e as B,s as f,r as k,w as ce,u as We,f as E,g as Xe,h as Q,i as J,j as K,k as Y,F as Le,l as Me,n as ze,T as de,m as ue,p as qe,q as me,v as Re,x as Ae,y as j,z as D,A as Ue,B as Ze,C as Ge,D as Qe,E as Je,G as Ke,H as Ne,I as et}from"./index-6f31a8db.js";const tt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},st=y("path",{fill:"currentColor",d:"M19.875 3H4.125C2.953 3 2 3.897 2 5v14c0 1.103.953 2 2.125 2h15.75C21.047 21 22 20.103 22 19V5c0-1.103-.953-2-2.125-2zm0 16H4.125c-.057 0-.096-.016-.113-.016c-.007 0-.011.002-.012.008L3.988 5.046c.007-.01.052-.046.137-.046h15.75c.079.001.122.028.125.008l.012 13.946c-.007.01-.052.046-.137.046z"},null,-1),nt=y("path",{fill:"currentColor",d:"M6 7h6v6H6zm7 8H6v2h12v-2h-4zm1-4h4v2h-4zm0-4h4v2h-4z"},null,-1),ot=[st,nt];function rt(t,e){return x(),S("svg",tt,ot)}const it={name:"bx-bx-news",render:rt},at=["id"],lt=["stroke"],ct=["cx","cy"],ut=W({__name:"Connector",props:{svg:{type:String,required:!0},id:{type:String,required:!0},target:{type:String,required:!0}},setup(t){const e=t,{svg:n,id:s,target:o}=Ye(e);le(()=>{p()});const r=B(()=>s.value.split(".")[0]),i=B(()=>o.value.split(".")[0]),a=B(()=>f.tables[`${r.value}`]?f.tables[`${r.value}`].position:{x:0,y:0}),l=B(()=>f.tables[`${i.value}`]?f.tables[`${i.value}`].position:{x:0,y:0}),h=k({x:0,y:0});ce([a,l],()=>{p()},{deep:!0});const d=k(null),p=()=>{if(!d.value)return;const c=document.getElementById(n.value),u=document.getElementById(s.value),g=document.getElementById(o.value),v=u.offsetTop,w=u.offsetHeight,C=u.offsetLeft,T=u.offsetWidth,q=g.offsetTop,re=g.offsetHeight,N=g.offsetLeft,X=g.offsetWidth,U=a.value.y+v+w/2,ie=l.value.y+q+re/2,M=ie-U,ge=M>0?U:ie;let L=a.value.x+C,R=l.value.x+N,P=R-L,A=P>0?L:R;P+X>0&&P+X<T+X?(L=a.value.x+T,R=l.value.x+X,P=R-L,P<0?A=R:A=L,d.value.setAttribute("d",`M ${Math.abs(L-A)} ${M>0?10:Math.abs(M-10)} H ${Math.abs(P)+30} V ${M>0?Math.abs(M)+10:10} H ${Math.abs(R-A)}`)):P>0?(L=a.value.x+T,R=N+l.value.x,P=R-L,A=L,d.value.setAttribute("d",`M ${Math.abs(L-A)} ${M>0?10:Math.abs(M-10)} H ${Math.abs(L-A+P/2)} V ${M>0?Math.abs(M)+10:10} H ${Math.abs(R-A)}`)):(L=a.value.x+C,R=X+l.value.x,P=R-L,A=R,d.value.setAttribute("d",`M ${Math.abs(L-A)} ${M>0?10:Math.abs(M-10)} H ${Math.abs(L-A+P/2)} V ${M>0?Math.abs(M)+10:10} H ${Math.abs(R-A)}`)),c.style.left=A+"px",c.style.top=ge-10+"px",c.setAttribute("width",`${Math.abs(P)+40}`),c.setAttribute("height",`${Math.abs(M)+20}`),h.value.x=R-A+2,h.value.y=ie-ge+10},m=k(!1);ce(()=>f.tableHighlighted,c=>{c?(r.value==c||i.value==c)&&(m.value=!0):m.value=!1});const _=We(),b=B(()=>m.value?"rgb(16, 185, 129)":_.value?"rgba(255,255,255,0.5)":"rgba(214, 211, 209, 0.5)");return(c,u)=>(x(),S("svg",{class:"absolute z-10",id:E(n),width:"0",height:"0","pointer-events":"none"},[y("path",{ref_key:"path",ref:d,class:"fill-transparent",stroke:E(b),"pointer-events":"visibleStroke",style:{"stroke-width":"3px"},onMouseenter:u[0]||(u[0]=g=>m.value=!0),onMouseleave:u[1]||(u[1]=g=>m.value=!1)},null,40,lt),y("circle",{cx:h.value.x,cy:h.value.y,r:"7",class:"text-warm-gray-400 dark:text-white fill-current"}," fk ",8,ct)],8,at))}}),ht=["id","onMousedown"],dt={class:"py-2 pb-3 px-2 text-dark-200 dark:text-light-500 bg-warm-gray-200 dark:bg-dark-800 font-medium text-lg text-center border-b-2 dark:border-dark-border"},mt=["id"],ft={class:"flex-grow"},pt={class:"ml-10 flex-grow-0 text-sm text-white-900"},gt=W({__name:"Table",props:{table:{type:Object,required:!0},scale:{type:Number,required:!0},mounted:Boolean},emits:["tableDragging"],setup(t,{emit:e}){const n=t,{scale:s,table:o}=Xe(n),r=k(!1),i=k(0),a=k(0),l=B(()=>f.tables[`${o.value.title}`].position),h=k({}),d=b=>{b.which==1&&(e("tableDragging",!0),r.value=!0,document.onmousemove=p,document.onmouseup=m,f.tableSelected.size?f.tableSelected.forEach(c=>{h.value[c.id]={ix:b.clientX-f.tables[c.id].position.x*s.value,iy:b.clientY-f.tables[c.id].position.y*s.value}}):(i.value=b.clientX-l.value.x*s.value,a.value=b.clientY-l.value.y*s.value))},p=b=>{r&&(f.tableSelected.size?f.tableSelected.forEach(c=>{f.tables[c.id].position={x:(b.clientX-h.value[c.id].ix)/s.value,y:(b.clientY-h.value[c.id].iy)/s.value}}):f.tables[`${o.value.title}`].position={x:(b.clientX-i.value)/s.value,y:(b.clientY-a.value)/s.value})},m=b=>{e("tableDragging",!1),h.value={},r.value=!1,document.onmousemove=null,document.onmouseup=null},_=k(!1);return ce(_,b=>{b?f.tableHighlighted=o.value.title:f.tableHighlighted=""}),(b,c)=>{var g,v;const u=it;return x(),S("div",{id:E(o).title,class:"selectable pb-2 absolute z-20 box rounded-md overflow-hidden bg-warm-gray-100 dark:bg-dark-700 border-2 dark:border-dark-border !hover:border-green-500",style:ue([{top:E(l).y+"px",left:E(l).x+"px"},{cursor:"grab"}]),onMousedown:qe(d,["prevent"]),onMouseenter:c[0]||(c[0]=w=>_.value=!0),onMouseleave:c[1]||(c[1]=w=>_.value=!1)},[y("h5",dt,[E(o).is_view?(x(),Q(u,{key:0,class:"inline mb-1px mr-2"})):J("",!0),K(" "+Y((g=E(o))==null?void 0:g.title),1)]),(x(!0),S(Le,null,Me((v=E(o))==null?void 0:v.columns,w=>{var C,T,q;return x(),S("div",{key:w.title},[y("div",{class:ze(["py-1 px-4 flex items-center text-dark-100 dark:text-white-800 border-l-3 border-transparent hover:bg-warm-gray-200 dark:hover:bg-dark-600 dark:hover:text-white",{"border-green-500":w.pk}]),id:`${(C=E(o))==null?void 0:C.title}.${w.title}`},[y("p",ft,Y(w.title),1),y("p",pt,Y(w.format),1)],10,mt),t.mounted?(x(),Q(de,{key:0,to:"#canvas-children"},[w.fk!=null?(x(),Q(ut,{key:0,svg:`svg-${(T=E(o))==null?void 0:T.title}.${w.title}`,id:`${(q=E(o))==null?void 0:q.title}.${w.title}`,target:w.fk},null,8,["svg","id","target"])):J("",!0)])):J("",!0)])}),128))],44,ht)}}}),_t={key:0,class:"w-screen h-screen fixed top-0 left-0 flex items-center justify-center bg-light-400 dark:bg-dark-900 !bg-opacity-50"},vt={class:"text-dark-100 dark:text-white p-4 border-b-2 dark:border-dark-600 flex items-center justify-between"},bt=y("h1",{class:"text-xl"},"Export SQL",-1),yt={class:"p-4 text-dark-100 dark:text-white h-full overflow-hidden overflow-y-auto"},wt=y("p",{class:"mb-4"},[K(" There might be some issues with the exported code. You may submit "),y("a",{href:"https://github.com/zernonia/supabase-schema/issues",target:"_blank",class:"underline"},"issues here"),K(". ")],-1),xt={class:"bg-warm-gray-200 dark:bg-dark-900 text-warm-gray-500 dark:text-white-800 text-sm rounded-md p-4 h-auto"},St=W({__name:"ModalSQL",props:{open:Boolean},emits:["close"],setup(t,{emit:e}){const n=["user","database","default","dictionary","files","group","index","level","max","min","password","procedure","table","user","view"],s=B(()=>{let l="";const h={};Object.entries(f.tables).forEach(([m,_])=>{var b;h[m]=(b=_.columns)==null?void 0:b.map(c=>{var u;return(u=c.fk)==null?void 0:u.split(".")[0]}).filter(c=>typeof c=="string").filter(c=>m!=c)});let d=Object.keys(h),p=[];for(;d.length;)for(let m in d){let _=d[m];h[_].every(c=>p.includes(c))&&(p.push(_),d.splice(+m,1))}return p.forEach(m=>{var c;if(f.tables[m].is_view)return;const _=m,b=f.tables[m];l+=`create table ${_} (
`,(c=b.columns)==null||c.forEach((u,g,v)=>{n.includes(u.title)?l+=`  "${u.title}"`:l+=`  ${u.title}`,u.format=="integer"&&u.pk?l+=" serial":l+=` ${u.format}`,u.fk&&(l+=` references ${u.fk.split(".")[0]} (${u.fk.split(".")[1]})`),(u.format=="date"||u.format.includes("timestamp"))&&(l+=" default now()"),u.required&&u.format=="uuid"&&!u.fk?l+=" default uuid_generate_v4()":u.required&&!u.fk&&(l+=" not null"),u.pk&&(l+=" primary key"),g==v.length-1?l+=`
`:l+=`,
`}),l+=`);

`}),l}),{text:o,copy:r,copied:i}=me({source:s}),a=k();return Re(a,l=>{e("close")}),(l,h)=>(x(),Q(de,{to:"body"},[t.open?(x(),S("div",_t,[y("div",{ref_key:"target",ref:a,class:"bg-warm-gray-100 dark:bg-dark-800 w-full max-w-screen-md h-screen-sm rounded-md border-2 dark:border-dark-600 flex flex-col"},[y("div",vt,[bt,y("button",{class:"btn-green",onClick:h[0]||(h[0]=d=>E(r)(E(s)))},Y(E(i)?"Copied!":"Copy"),1)]),y("div",yt,[wt,y("pre",xt,Y(E(s)),1)])],512)])):J("",!0)]))}}),Et={viewBox:"0 0 20 20",width:"1.2em",height:"1.2em"},$t=y("path",{fill:"currentColor","fill-rule":"evenodd",d:"M10 5a1 1 0 0 1 1 1v3h3a1 1 0 1 1 0 2h-3v3a1 1 0 1 1-2 0v-3H6a1 1 0 1 1 0-2h3V6a1 1 0 0 1 1-1Z","clip-rule":"evenodd"},null,-1),kt=[$t];function Ct(t,e){return x(),S("svg",Et,kt)}const Tt={name:"heroicons-solid-plus-sm",render:Ct},Lt={viewBox:"0 0 20 20",width:"1.2em",height:"1.2em"},Mt=y("path",{fill:"currentColor","fill-rule":"evenodd",d:"M5 10a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1Z","clip-rule":"evenodd"},null,-1),Rt=[Mt];function At(t,e){return x(),S("svg",Lt,Rt)}const Vt={name:"heroicons-solid-minus-sm",render:At},Ht={class:"flex items-center border-2 bg-warm-gray-100 overflow-hidden dark:bg-dark-800 dark:border-dark-border rounded-md opacity-50 hover:opacity-100"},Dt={class:"px-3 w-24 border-x-2 border-dark-border text-center"},Pt=W({__name:"HelperZoom",setup(t){const e=n=>{if(n=="plus"){if(f.schemaView.scale>=3)return;f.schemaView.scale+=.1}else{if(f.schemaView.scale<=.47)return;f.schemaView.scale-=.1}};return(n,s)=>{const o=Vt,r=Tt,i=Ae("tooltip");return x(),S("div",Ht,[j((x(),S("button",{onClick:s[0]||(s[0]=a=>e("minus")),class:"p-3 flex hover:bg-warm-gray-200 dark:hover:bg-dark-600 focus:outline-none"},[D(o)])),[[i,"Zoom out"]]),y("p",Dt,Y((E(f).schemaView.scale*100).toFixed(0))+"% ",1),j((x(),S("button",{onClick:s[1]||(s[1]=a=>e("plus")),class:"p-3 flex hover:bg-warm-gray-200 dark:hover:bg-dark-600 focus:outline-none"},[D(r)])),[[i,"Zoom in"]])])}}}),Bt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},It=y("path",{fill:"currentColor",d:"M3 9a1 1 0 0 0 1-1V5a1 1 0 0 1 1-1h3a1 1 0 0 0 0-2H5a3 3 0 0 0-3 3v3a1 1 0 0 0 1 1Zm5 11H5a1 1 0 0 1-1-1v-3a1 1 0 0 0-2 0v3a3 3 0 0 0 3 3h3a1 1 0 0 0 0-2Zm9-7a1 1 0 0 0 0-2h-1.14A4 4 0 0 0 13 8.14V7a1 1 0 0 0-2 0v1.14A4 4 0 0 0 8.14 11H7a1 1 0 0 0 0 2h1.14A4 4 0 0 0 11 15.86V17a1 1 0 0 0 2 0v-1.14A4 4 0 0 0 15.86 13Zm-5 1a2 2 0 1 1 2-2a2 2 0 0 1-2 2Zm9 1a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 0 0 2h3a3 3 0 0 0 3-3v-3a1 1 0 0 0-1-1ZM19 2h-3a1 1 0 0 0 0 2h3a1 1 0 0 1 1 1v3a1 1 0 0 0 2 0V5a3 3 0 0 0-3-3Z"},null,-1),Ot=[It];function Ft(t,e){return x(),S("svg",Bt,Ot)}const jt={name:"uil-focus-target",render:Ft},Yt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Wt=y("path",{fill:"currentColor",d:"M7.5 5.6L10 7L8.6 4.5L10 2L7.5 3.4L5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.996.996 0 0 0-1.41 0L1.29 18.96a.996.996 0 0 0 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05a.996.996 0 0 0 0-1.41l-2.33-2.35zm-1.03 5.49l-2.12-2.12l2.44-2.44l2.12 2.12l-2.44 2.44z"},null,-1),Xt=[Wt];function zt(t,e){return x(),S("svg",Yt,Xt)}const qt={name:"ic-baseline-auto-fix-high",render:zt},Ut={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Zt=y("path",{fill:"currentColor",d:"M20 4h-3.17L15 2H9L7.17 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2m0 14H4V6h4.05l1.83-2h4.24l1.83 2H20v12M12 7a5 5 0 0 0-5 5a5 5 0 0 0 5 5a5 5 0 0 0 5-5a5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3a3 3 0 0 1 3-3a3 3 0 0 1 3 3a3 3 0 0 1-3 3Z"},null,-1),Gt=[Zt];function Qt(t,e){return x(),S("svg",Ut,Gt)}const Jt={name:"mdi-camera-outline",render:Qt},Kt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Nt=y("path",{fill:"currentColor",d:"m17.86 18l1.04 1c-1.4 1.2-3.96 2-6.9 2c-4.41 0-8-1.79-8-4V7c0-2.21 3.58-4 8-4c2.95 0 5.5.8 6.9 2l-1.04 1l-.36.4C16.65 5.77 14.78 5 12 5C8.13 5 6 6.5 6 7s2.13 2 6 2c1.37 0 2.5-.19 3.42-.46l.96.96H13.5v1.42c-.5.05-1 .08-1.5.08c-2.39 0-4.53-.53-6-1.36v2.81C7.3 13.4 9.58 14 12 14c.5 0 1-.03 1.5-.08v.58h2.88l-1 1l.12.11c-1.09.25-2.26.39-3.5.39c-2.28 0-4.39-.45-6-1.23V17c0 .5 2.13 2 6 2c2.78 0 4.65-.77 5.5-1.39l.36.39m1.06-10.92L17.5 8.5L20 11h-5v2h5l-2.5 2.5l1.42 1.42L23.84 12l-4.92-4.92Z"},null,-1),es=[Nt];function ts(t,e){return x(),S("svg",Kt,es)}const ss={name:"mdi-database-export-outline",render:ts},ns={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},os=y("path",{fill:"currentColor",d:"M3 3h18v18H3V3m10.71 14.86c.5.98 1.51 1.73 3.09 1.73c1.6 0 2.8-.83 2.8-2.36c0-1.41-.81-2.04-2.25-2.66l-.42-.18c-.73-.31-1.04-.52-1.04-1.02c0-.41.31-.73.81-.73c.48 0 .8.21 1.09.73l1.31-.87c-.55-.96-1.33-1.33-2.4-1.33c-1.51 0-2.48.96-2.48 2.23c0 1.38.81 2.03 2.03 2.55l.42.18c.78.34 1.24.55 1.24 1.13c0 .48-.45.83-1.15.83c-.83 0-1.31-.43-1.67-1.03l-1.38.8M13 11.25H8v1.5h1.5V20h1.75v-7.25H13v-1.5Z"},null,-1),rs=[os];function is(t,e){return x(),S("svg",ns,rs)}const as={name:"mdi-language-typescript",render:is},ls={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},cs=y("path",{fill:"currentColor",d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81c1.66 0 3-1.34 3-3s-1.34-3-3-3s-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66c0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91s-1.31-2.92-2.92-2.92M18 4c.55 0 1 .45 1 1s-.45 1-1 1s-1-.45-1-1s.45-1 1-1M6 13c-.55 0-1-.45-1-1s.45-1 1-1s1 .45 1 1s-.45 1-1 1m12 7c-.55 0-1-.45-1-1s.45-1 1-1s1 .45 1 1s-.45 1-1 1Z"},null,-1),us=[cs];function hs(t,e){return x(),S("svg",ls,us)}const ds={name:"mdi-share-variant-outline",render:hs};function ms(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),s=n.createElement("base"),o=n.createElement("a");return n.head.appendChild(s),n.body.appendChild(o),e&&(s.href=e),o.href=t,o.href}const fs=(()=>{let t=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${e()}${t}`)})();function I(t){const e=[];for(let n=0,s=t.length;n<s;n++)e.push(t[n]);return e}function se(t,e){const s=(t.ownerDocument.defaultView||window).getComputedStyle(t).getPropertyValue(e);return s?parseFloat(s.replace("px","")):0}function ps(t){const e=se(t,"border-left-width"),n=se(t,"border-right-width");return t.clientWidth+e+n}function gs(t){const e=se(t,"border-top-width"),n=se(t,"border-bottom-width");return t.clientHeight+e+n}function Ve(t,e={}){const n=e.width||ps(t),s=e.height||gs(t);return{width:n,height:s}}function _s(){let t,e;try{e=process}catch{}const n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}const H=16384;function vs(t){(t.width>H||t.height>H)&&(t.width>H&&t.height>H?t.width>t.height?(t.height*=H/t.width,t.width=H):(t.width*=H/t.height,t.height=H):t.width>H?(t.height*=H/t.width,t.width=H):(t.width*=H/t.height,t.height=H))}function ne(t){return new Promise((e,n)=>{const s=new Image;s.decode=()=>e(s),s.onload=()=>e(s),s.onerror=n,s.crossOrigin="anonymous",s.decoding="async",s.src=t})}async function bs(t){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(t)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function ys(t,e,n){const s="http://www.w3.org/2000/svg",o=document.createElementNS(s,"svg"),r=document.createElementNS(s,"foreignObject");return o.setAttribute("width",`${e}`),o.setAttribute("height",`${n}`),o.setAttribute("viewBox",`0 0 ${e} ${n}`),r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("externalResourcesRequired","true"),o.appendChild(r),r.appendChild(t),bs(o)}const V=(t,e)=>{if(t instanceof e)return!0;const n=Object.getPrototypeOf(t);return n===null?!1:n.constructor.name===e.name||V(n,e)};function ws(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}function xs(t){return I(t).map(e=>{const n=t.getPropertyValue(e),s=t.getPropertyPriority(e);return`${e}: ${n}${s?" !important":""};`}).join(" ")}function Ss(t,e,n){const s=`.${t}:${e}`,o=n.cssText?ws(n):xs(n);return document.createTextNode(`${s}{${o}}`)}function _e(t,e,n){const s=window.getComputedStyle(t,n),o=s.getPropertyValue("content");if(o===""||o==="none")return;const r=fs();try{e.className=`${e.className} ${r}`}catch{return}const i=document.createElement("style");i.appendChild(Ss(r,n,s)),e.appendChild(i)}function Es(t,e){_e(t,e,":before"),_e(t,e,":after")}const ve="application/font-woff",be="image/jpeg",$s={woff:ve,woff2:ve,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:be,jpeg:be,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function ks(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}function fe(t){const e=ks(t).toLowerCase();return $s[e]||""}function Cs(t){return t.split(/,/)[1]}function he(t){return t.search(/^(data:)/)!==-1}function He(t,e){return`data:${e};base64,${t}`}async function De(t,e,n){const s=await fetch(t,e);if(s.status===404)throw new Error(`Resource "${s.url}" not found`);const o=await s.blob();return new Promise((r,i)=>{const a=new FileReader;a.onerror=i,a.onloadend=()=>{try{r(n({res:s,result:a.result}))}catch(l){i(l)}},a.readAsDataURL(o)})}const ae={};function Ts(t,e,n){let s=t.replace(/\?.*/,"");return n&&(s=t),/ttf|otf|eot|woff2?/i.test(s)&&(s=s.replace(/.*\//,"")),e?`[${e}]${s}`:s}async function pe(t,e,n){const s=Ts(t,e,n.includeQueryParams);if(ae[s]!=null)return ae[s];n.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+new Date().getTime());let o;try{const r=await De(t,n.fetchRequestInit,({res:i,result:a})=>(e||(e=i.headers.get("Content-Type")||""),Cs(a)));o=He(r,e)}catch(r){o=n.imagePlaceholder||"";let i=`Failed to fetch resource: ${t}`;r&&(i=typeof r=="string"?r:r.message),i&&console.warn(i)}return ae[s]=o,o}async function Ls(t){const e=t.toDataURL();return e==="data:,"?t.cloneNode(!1):ne(e)}async function Ms(t,e){if(t.currentSrc){const r=document.createElement("canvas"),i=r.getContext("2d");r.width=t.clientWidth,r.height=t.clientHeight,i==null||i.drawImage(t,0,0,r.width,r.height);const a=r.toDataURL();return ne(a)}const n=t.poster,s=fe(n),o=await pe(n,s,e);return ne(o)}async function Rs(t){var e;try{if(!((e=t==null?void 0:t.contentDocument)===null||e===void 0)&&e.body)return await oe(t.contentDocument.body,{},!0)}catch{}return t.cloneNode(!1)}async function As(t,e){return V(t,HTMLCanvasElement)?Ls(t):V(t,HTMLVideoElement)?Ms(t,e):V(t,HTMLIFrameElement)?Rs(t):t.cloneNode(!1)}const Vs=t=>t.tagName!=null&&t.tagName.toUpperCase()==="SLOT";async function Hs(t,e,n){var s,o;let r=[];return Vs(t)&&t.assignedNodes?r=I(t.assignedNodes()):V(t,HTMLIFrameElement)&&(!((s=t.contentDocument)===null||s===void 0)&&s.body)?r=I(t.contentDocument.body.childNodes):r=I(((o=t.shadowRoot)!==null&&o!==void 0?o:t).childNodes),r.length===0||V(t,HTMLVideoElement)||await r.reduce((i,a)=>i.then(()=>oe(a,n)).then(l=>{l&&e.appendChild(l)}),Promise.resolve()),e}function Ds(t,e){const n=e.style;if(!n)return;const s=window.getComputedStyle(t);s.cssText?(n.cssText=s.cssText,n.transformOrigin=s.transformOrigin):I(s).forEach(o=>{let r=s.getPropertyValue(o);o==="font-size"&&r.endsWith("px")&&(r=`${Math.floor(parseFloat(r.substring(0,r.length-2)))-.1}px`),V(t,HTMLIFrameElement)&&o==="display"&&r==="inline"&&(r="block"),o==="d"&&e.getAttribute("d")&&(r=`path(${e.getAttribute("d")})`),n.setProperty(o,r,s.getPropertyPriority(o))})}function Ps(t,e){V(t,HTMLTextAreaElement)&&(e.innerHTML=t.value),V(t,HTMLInputElement)&&e.setAttribute("value",t.value)}function Bs(t,e){if(V(t,HTMLSelectElement)){const n=e,s=Array.from(n.children).find(o=>t.value===o.getAttribute("value"));s&&s.setAttribute("selected","")}}function Is(t,e){return V(e,Element)&&(Ds(t,e),Es(t,e),Ps(t,e),Bs(t,e)),e}async function Os(t,e){const n=t.querySelectorAll?t.querySelectorAll("use"):[];if(n.length===0)return t;const s={};for(let r=0;r<n.length;r++){const a=n[r].getAttribute("xlink:href");if(a){const l=t.querySelector(a),h=document.querySelector(a);!l&&h&&!s[a]&&(s[a]=await oe(h,e,!0))}}const o=Object.values(s);if(o.length){const r="http://www.w3.org/1999/xhtml",i=document.createElementNS(r,"svg");i.setAttribute("xmlns",r),i.style.position="absolute",i.style.width="0",i.style.height="0",i.style.overflow="hidden",i.style.display="none";const a=document.createElementNS(r,"defs");i.appendChild(a);for(let l=0;l<o.length;l++)a.appendChild(o[l]);t.appendChild(i)}return t}async function oe(t,e,n){return!n&&e.filter&&!e.filter(t)?null:Promise.resolve(t).then(s=>As(s,e)).then(s=>Hs(t,s,e)).then(s=>Is(t,s)).then(s=>Os(s,e))}const Pe=/url\((['"]?)([^'"]+?)\1\)/g,Fs=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,js=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Ys(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function Ws(t){const e=[];return t.replace(Pe,(n,s,o)=>(e.push(o),n)),e.filter(n=>!he(n))}async function Xs(t,e,n,s,o){try{const r=n?ms(e,n):e,i=fe(e);let a;if(o){const l=await o(r);a=He(l,i)}else a=await pe(r,i,s);return t.replace(Ys(e),`$1${a}$3`)}catch{}return t}function zs(t,{preferredFontFormat:e}){return e?t.replace(js,n=>{for(;;){const[s,,o]=Fs.exec(n)||[];if(!o)return"";if(o===e)return`src: ${s};`}}):t}function Be(t){return t.search(Pe)!==-1}async function Ie(t,e,n){if(!Be(t))return t;const s=zs(t,n);return Ws(s).reduce((r,i)=>r.then(a=>Xs(a,i,e,n)),Promise.resolve(s))}async function ee(t,e,n){var s;const o=(s=e.style)===null||s===void 0?void 0:s.getPropertyValue(t);if(o){const r=await Ie(o,null,n);return e.style.setProperty(t,r,e.style.getPropertyPriority(t)),!0}return!1}async function qs(t,e){await ee("background",t,e)||await ee("background-image",t,e),await ee("mask",t,e)||await ee("mask-image",t,e)}async function Us(t,e){const n=V(t,HTMLImageElement);if(!(n&&!he(t.src))&&!(V(t,SVGImageElement)&&!he(t.href.baseVal)))return;const s=n?t.src:t.href.baseVal,o=await pe(s,fe(s),e);await new Promise((r,i)=>{t.onload=r,t.onerror=i;const a=t;a.decode&&(a.decode=r),a.loading==="lazy"&&(a.loading="eager"),n?(t.srcset="",t.src=o):t.href.baseVal=o})}async function Zs(t,e){const s=I(t.childNodes).map(o=>Oe(o,e));await Promise.all(s).then(()=>t)}async function Oe(t,e){V(t,Element)&&(await qs(t,e),await Us(t,e),await Zs(t,e))}function Gs(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const s=e.style;return s!=null&&Object.keys(s).forEach(o=>{n[o]=s[o]}),t}const ye={};async function we(t){let e=ye[t];if(e!=null)return e;const s=await(await fetch(t)).text();return e={url:t,cssText:s},ye[t]=e,e}async function xe(t,e){let n=t.cssText;const s=/url\(["']?([^"')]+)["']?\)/g,r=(n.match(/url\([^)]+\)/g)||[]).map(async i=>{let a=i.replace(s,"$1");return a.startsWith("https://")||(a=new URL(a,t.url).href),De(a,e.fetchRequestInit,({result:l})=>(n=n.replace(i,`url(${l})`),[i,l]))});return Promise.all(r).then(()=>n)}function Se(t){if(t==null)return[];const e=[],n=/(\/\*[\s\S]*?\*\/)/gi;let s=t.replace(n,"");const o=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const l=o.exec(s);if(l===null)break;e.push(l[0])}s=s.replace(o,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(i,"gi");for(;;){let l=r.exec(s);if(l===null){if(l=a.exec(s),l===null)break;r.lastIndex=a.lastIndex}else a.lastIndex=r.lastIndex;e.push(l[0])}return e}async function Qs(t,e){const n=[],s=[];return t.forEach(o=>{if("cssRules"in o)try{I(o.cssRules||[]).forEach((r,i)=>{if(r.type===CSSRule.IMPORT_RULE){let a=i+1;const l=r.href,h=we(l).then(d=>xe(d,e)).then(d=>Se(d).forEach(p=>{try{o.insertRule(p,p.startsWith("@import")?a+=1:o.cssRules.length)}catch(m){console.error("Error inserting rule from remote css",{rule:p,error:m})}})).catch(d=>{console.error("Error loading remote css",d.toString())});s.push(h)}})}catch(r){const i=t.find(a=>a.href==null)||document.styleSheets[0];o.href!=null&&s.push(we(o.href).then(a=>xe(a,e)).then(a=>Se(a).forEach(l=>{i.insertRule(l,o.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",r)}}),Promise.all(s).then(()=>(t.forEach(o=>{if("cssRules"in o)try{I(o.cssRules||[]).forEach(r=>{n.push(r)})}catch(r){console.error(`Error while reading CSS rules from ${o.href}`,r)}}),n))}function Js(t){return t.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>Be(e.style.getPropertyValue("src")))}async function Ks(t,e){if(t.ownerDocument==null)throw new Error("Provided element is not within a Document");const n=I(t.ownerDocument.styleSheets),s=await Qs(n,e);return Js(s)}async function Ns(t,e){const n=await Ks(t,e);return(await Promise.all(n.map(o=>{const r=o.parentStyleSheet?o.parentStyleSheet.href:null;return Ie(o.cssText,r,e)}))).join(`
`)}async function en(t,e){const n=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await Ns(t,e);if(n){const s=document.createElement("style"),o=document.createTextNode(n);s.appendChild(o),t.firstChild?t.insertBefore(s,t.firstChild):t.appendChild(s)}}async function tn(t,e={}){const{width:n,height:s}=Ve(t,e),o=await oe(t,e,!0);return await en(o,e),await Oe(o,e),Gs(o,e),await ys(o,n,s)}async function sn(t,e={}){const{width:n,height:s}=Ve(t,e),o=await tn(t,e),r=await ne(o),i=document.createElement("canvas"),a=i.getContext("2d"),l=e.pixelRatio||_s(),h=e.canvasWidth||n,d=e.canvasHeight||s;return i.width=h*l,i.height=d*l,e.skipAutoScale||vs(i),i.style.width=`${h}`,i.style.height=`${d}`,e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,i.width,i.height)),a.drawImage(r,0,0,i.width,i.height),i}async function nn(t,e={}){return(await sn(t,e)).toDataURL()}const on={key:0,class:"w-screen h-screen fixed top-0 left-0 flex items-center justify-center bg-light-400 dark:bg-dark-900 !bg-opacity-50"},rn={class:"text-dark-100 dark:text-white p-4 border-b-2 dark:border-dark-600 flex items-center justify-between"},an=y("h1",{class:"text-xl"},"Export Types (for Typescript)",-1),ln={class:"p-4 text-dark-100 dark:text-white h-full overflow-hidden overflow-y-auto"},cn=y("p",{class:"mb-4"},[K(" There might be some issues with the exported code. You may submit "),y("a",{href:"https://github.com/zernonia/supabase-schema/issues",target:"_blank",class:"underline"},"issues here"),K(". ")],-1),un={class:"bg-warm-gray-200 dark:bg-dark-900 text-warm-gray-500 dark:text-white-800 text-sm rounded-md p-4 h-auto"},hn=W({__name:"ModalTypes",props:{open:Boolean},emits:["close"],setup(t,{emit:e}){const n=l=>l.charAt(0).toUpperCase()+l.slice(1),s=B(()=>{const l={uuid:"string",text:"string",char:"string",character:"string",varchar:"string",ARRAY:"any[]",boolean:"boolean",date:"string",time:"string",timestamp:"string",timestamptz:"string",interval:"string",json:"json",smallint:"number",int:"number",integer:"number",bigint:"number",float:"number",float8:"number"};let h="";const d={};Object.entries(f.tables).forEach(([_,b])=>{var c;d[_]=(c=b.columns)==null?void 0:c.map(u=>{var g;return(g=u.fk)==null?void 0:g.split(".")[0]}).filter(u=>typeof u=="string").filter(u=>_!=u)});let p=Object.keys(d),m=[];for(;p.length;)for(let _ in p){let b=p[_];d[b].every(u=>m.includes(u))&&(m.push(b),p.splice(+_,1))}return m.forEach(_=>{var u,g;const b=_,c=f.tables[_];h+=`interface ${n(b)} {
`,(u=c.columns)==null||u.forEach((v,w,C)=>{h+=`  ${v.title}`,v.required||(h+="?"),h+=": ",h+=l[v.format]?l[v.format]:"any // type unknown",v.pk&&(h+="   /* primary key */"),v.fk&&(h+=`   /* foreign key to ${v.fk} */`),h+=`;
`}),(g=c.columns)==null||g.map(v=>v.fk).filter(v=>typeof v=="string").forEach(v=>{let w=v==null?void 0:v.split(".")[0];h+=`  ${w}?: ${n(w)};
`}),h+=`};

`}),h}),{text:o,copy:r,copied:i}=me({source:""}),a=k();return Re(a,l=>{e("close")}),(l,h)=>(x(),Q(de,{to:"body"},[t.open?(x(),S("div",on,[y("div",{ref_key:"target",ref:a,class:"bg-warm-gray-100 dark:bg-dark-800 w-full max-w-screen-md h-screen-sm rounded-md border-2 dark:border-dark-600 flex flex-col"},[y("div",rn,[an,y("button",{class:"btn-green",onClick:h[0]||(h[0]=d=>E(r)(E(s)))},Y(E(i)?"Copied!":"Copy"),1)]),y("div",ln,[cn,y("pre",un,Y(E(s)),1)])],512)])):J("",!0)]))}}),dn={class:"flex items-center space-x-3 right-3.95 bottom-5 absolute z-10"},mn=W({__name:"Helper",setup(t){const e=()=>{f.autoArrange(),Ue(()=>{n()})},n=()=>{const p=Object.values(f.tables).map(U=>U.position.x),m=Math.min.apply(null,p),_=Math.max.apply(null,p)+300,b=Object.values(f.tables).map(U=>U.position.y),c=Math.min.apply(null,b),u=Math.max.apply(null,b)+300,g=_-m+100*2,v=u-c+100*2,w=window.innerWidth/g,C=window.innerHeight/v,T=Math.min(w,C);f.schemaView.scale=T;const q=(window.innerWidth-g*T)*T,re=(window.innerHeight-v*T)*T,N=(-1*m+q+100)*T,X=(-1*c+re+100)*T;f.schemaView.translate.x=N,f.schemaView.translate.y=X},s=()=>{const h=document.getElementById("screen-canvas");nn(h).then(d=>{var p=document.createElement("a");p.download="Supbase Schema.png",p.href=d,p.click()})},o=k(!1),r=k(!1),{copy:i,copied:a}=me(),l=()=>{JSON.parse(localStorage.getItem("supabase-apikey")??""),JSON.parse(localStorage.getItem("view")??""),JSON.parse(localStorage.getItem("table-list")??"");const h=Ze.encrypt(JSON.stringify({apikey:Ge.apikey,schemaView:f.schemaView,tables:f.tables}),"this password doesnt matter").toString(),d=new URL(window.location.href);d.hash=h,i(d.toString())};return(h,d)=>{const p=ds,m=as,_=ss,b=Jt,c=qt,u=jt,g=Pt,v=St,w=Ae("tooltip");return x(),S("div",dn,[j((x(),S("button",{class:"btn",onClick:l},[D(p)])),[[w,E(a)?"Copied":"Share link"]]),j((x(),S("button",{class:"btn",onClick:d[0]||(d[0]=C=>r.value=!0)},[D(m)])),[[w,"Export Types"]]),j((x(),S("button",{class:"btn",onClick:d[1]||(d[1]=C=>o.value=!0)},[D(_)])),[[w,"Export SQL"]]),j((x(),S("button",{class:"btn",onClick:s},[D(b)])),[[w,"Take a screenshot"]]),j((x(),S("button",{class:"btn",onClick:e},[D(c)])),[[w,"Auto arrange"]]),j((x(),S("button",{class:"btn",onClick:n},[D(u)])),[[w,"Focus everything center"]]),D(g),D(v,{open:o.value,onClose:d[2]||(d[2]=C=>o.value=!1)},null,8,["open"]),D(hn,{open:r.value,onClose:d[3]||(d[3]=C=>r.value=!1)},null,8,["open"])])}}});/*! @viselect/vanilla v3.2.6 MIT | https://github.com/Simonwep/selection/tree/master/packages/vanilla */var fn=Object.defineProperty,pn=(t,e,n)=>e in t?fn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$=(t,e,n)=>(pn(t,typeof e!="symbol"?e+"":e,n),n);class gn{constructor(){$(this,"_listeners",new Map),$(this,"on",this.addEventListener),$(this,"off",this.removeEventListener),$(this,"emit",this.dispatchEvent)}addEventListener(e,n){const s=this._listeners.get(e)||new Set;return this._listeners.set(e,s),s.add(n),this}removeEventListener(e,n){var s;return(s=this._listeners.get(e))==null||s.delete(n),this}dispatchEvent(e,...n){let s=!0;for(const o of this._listeners.get(e)||[])s=o(...n)!==!1&&s;return s}unbindAllListeners(){this._listeners.clear()}}const Ee=(t,e="px")=>typeof t=="number"?t+e:t;function O({style:t},e,n){if(typeof e=="object")for(const[s,o]of Object.entries(e))o!==void 0&&(t[s]=Ee(o));else n!==void 0&&(t[e]=Ee(n))}function Fe(t){return(e,n,s,o={})=>{e instanceof HTMLCollection||e instanceof NodeList?e=Array.from(e):Array.isArray(e)||(e=[e]),Array.isArray(n)||(n=[n]);for(const r of e)for(const i of n)r[t](i,s,{capture:!1,...o});return[e,n,s,o]}}const Z=Fe("addEventListener"),F=Fe("removeEventListener"),te=t=>{const{clientX:e,clientY:n,target:s}=t.touches&&t.touches[0]||t;return{x:e,y:n,target:s}};function $e(t,e,n="touch"){switch(n){case"center":{const s=e.left+e.width/2,o=e.top+e.height/2;return s>=t.left&&s<=t.right&&o>=t.top&&o<=t.bottom}case"cover":return e.left>=t.left&&e.top>=t.top&&e.right<=t.right&&e.bottom<=t.bottom;case"touch":return t.right>=e.left&&t.left<=e.right&&t.bottom>=e.top&&t.top<=e.bottom}}function G(t,e=document){const n=Array.isArray(t)?t:[t];let s=[];for(let o=0,r=n.length;o<r;o++){const i=n[o];typeof i=="string"?s=s.concat(Array.from(e.querySelectorAll(i))):i instanceof Element&&s.push(i)}return s}const _n=()=>matchMedia("(hover: none), (pointer: coarse)").matches,vn=()=>"safari"in window,bn=t=>{let e,n=-1,s=!1;return{next(...o){e=o,s||(s=!0,n=requestAnimationFrame(()=>{t(...e),s=!1}))},cancel(){cancelAnimationFrame(n),s=!1}}},{abs:z,max:ke,min:Ce,ceil:Te}=Math;class je extends gn{constructor(e){var n,s,o,r,i;super(),$(this,"_options"),$(this,"_selection",{stored:[],selected:[],touched:[],changed:{added:[],removed:[]}}),$(this,"_area"),$(this,"_clippingElement"),$(this,"_targetElement"),$(this,"_targetRect"),$(this,"_selectables",[]),$(this,"_latestElement"),$(this,"_areaRect",new DOMRect),$(this,"_areaLocation",{y1:0,x2:0,y2:0,x1:0}),$(this,"_singleClick",!0),$(this,"_frame"),$(this,"_scrollAvailable",!0),$(this,"_scrollingActive",!1),$(this,"_scrollSpeed",{x:0,y:0}),$(this,"_scrollDelta",{x:0,y:0}),$(this,"disable",this._bindStartEvents.bind(this,!1)),$(this,"enable",this._bindStartEvents),this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...e,behaviour:{overlap:"invert",intersect:"touch",...e.behaviour,startThreshold:(n=e.behaviour)!=null&&n.startThreshold?typeof e.behaviour.startThreshold=="number"?e.behaviour.startThreshold:{x:10,y:10,...e.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...(s=e.behaviour)==null?void 0:s.scrolling,startScrollMargins:{x:0,y:0,...(r=(o=e.behaviour)==null?void 0:o.scrolling)==null?void 0:r.startScrollMargins}}},features:{range:!0,touch:!0,...e.features,singleTap:{allow:!0,intersect:"native",...(i=e.features)==null?void 0:i.singleTap}}};for(const d of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))typeof this[d]=="function"&&(this[d]=this[d].bind(this));const{document:a,selectionAreaClass:l,selectionContainerClass:h}=this._options;this._area=a.createElement("div"),this._clippingElement=a.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(l),h&&this._clippingElement.classList.add(h),O(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),O(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=bn(d=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",d),this._redrawSelectionArea()}),this.enable()}_bindStartEvents(e=!0){const{document:n,features:s}=this._options,o=e?Z:F;o(n,"mousedown",this._onTapStart),s.touch&&o(n,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(e,n=!1){const{x:s,y:o,target:r}=te(e),{_options:i}=this,{document:a}=this._options,l=r.getBoundingClientRect(),h=G(i.startAreas,i.document),d=G(i.boundaries,i.document);this._targetElement=d.find(_=>$e(_.getBoundingClientRect(),l));const p=e.composedPath();if(!this._targetElement||!h.find(_=>p.includes(_))||!d.find(_=>p.includes(_))||!n&&this._emitEvent("beforestart",e)===!1)return;this._areaLocation={x1:s,y1:o,x2:0,y2:0};const m=a.scrollingElement||a.body;this._scrollDelta={x:m.scrollLeft,y:m.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),Z(a,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),Z(a,["mouseup","touchcancel","touchend"],this._onTapStop),Z(a,"scroll",this._onScroll)}_onSingleTap(e){const{singleTap:{intersect:n},range:s}=this._options.features,o=te(e);let r;if(n==="native")r=o.target;else if(n==="touch"){this.resolveSelectables();const{x:a,y:l}=o;r=this._selectables.find(h=>{const{right:d,left:p,top:m,bottom:_}=h.getBoundingClientRect();return a<d&&a>p&&l<_&&l>m})}if(!r)return;for(this.resolveSelectables();!this._selectables.includes(r);){if(!r.parentElement)return;r=r.parentElement}const{stored:i}=this._selection;if(this._emitEvent("start",e),e.shiftKey&&i.length&&s){const a=this._latestElement??i[0],[l,h]=a.compareDocumentPosition(r)&4?[r,a]:[a,r],d=[...this._selectables.filter(p=>p.compareDocumentPosition(l)&4&&p.compareDocumentPosition(h)&2),l,h];this.select(d)}else i.includes(r)&&(i.length===1||e.ctrlKey||i.every(a=>this._selection.stored.includes(a)))?this.deselect(r):(this._latestElement=r,this.select(r));this._emitEvent("stop",e)}_delayedTapMove(e){const{container:n,document:s,behaviour:{startThreshold:o}}=this._options,{x1:r,y1:i}=this._areaLocation,{x:a,y:l}=te(e);if(typeof o=="number"&&z(a+l-(r+i))>=o||typeof o=="object"&&z(a-r)>=o.x||z(l-i)>=o.y){if(F(s,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),this._emitEvent("beforedrag",e)===!1){F(s,["mouseup","touchcancel","touchend"],this._onTapStop);return}Z(s,["mousemove","touchmove"],this._onTapMove,{passive:!1}),O(this._area,"display","block"),G(n,s)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(Z(s,"wheel",this._manualScroll,{passive:!1}),this._selectables=this._selectables.filter(h=>this._targetElement.contains(h))),this._setupSelectionArea(),this._emitEvent("start",e),this._onTapMove(e)}this._handleMoveEvent(e)}_setupSelectionArea(){const{_clippingElement:e,_targetElement:n,_area:s}=this,o=this._targetRect=n.getBoundingClientRect();this._scrollAvailable?(O(e,{top:o.top,left:o.left,width:o.width,height:o.height}),O(s,{marginTop:-o.top,marginLeft:-o.left})):(O(e,{top:0,left:0,width:"100%",height:"100%"}),O(s,{marginTop:0,marginLeft:0}))}_onTapMove(e){const{x:n,y:s}=te(e),{_scrollSpeed:o,_areaLocation:r,_options:i,_frame:a}=this,{speedDivider:l}=i.behaviour.scrolling,h=this._targetElement;if(r.x2=n,r.y2=s,this._scrollAvailable&&!this._scrollingActive&&(o.y||o.x)){this._scrollingActive=!0;const d=()=>{if(!o.x&&!o.y){this._scrollingActive=!1;return}const{scrollTop:p,scrollLeft:m}=h;o.y&&(h.scrollTop+=Te(o.y/l),r.y1-=h.scrollTop-p),o.x&&(h.scrollLeft+=Te(o.x/l),r.x1-=h.scrollLeft-m),a.next(e),requestAnimationFrame(d)};requestAnimationFrame(d)}else a.next(e);this._handleMoveEvent(e)}_handleMoveEvent(e){const{features:n}=this._options;(n.touch&&_n()||this._scrollAvailable&&vn())&&e.preventDefault()}_onScroll(){const{_scrollDelta:e,_options:{document:n}}=this,{scrollTop:s,scrollLeft:o}=n.scrollingElement||n.body;this._areaLocation.x1+=e.x-o,this._areaLocation.y1+=e.y-s,e.x=o,e.y=s,this._setupSelectionArea(),this._frame.next(null)}_manualScroll(e){const{manualSpeed:n}=this._options.behaviour.scrolling,s=e.deltaY?e.deltaY>0?1:-1:0,o=e.deltaX?e.deltaX>0?1:-1:0;this._scrollSpeed.y+=s*n,this._scrollSpeed.x+=o*n,this._onTapMove(e),e.preventDefault()}_recalculateSelectionAreaRect(){const{_scrollSpeed:e,_areaLocation:n,_areaRect:s,_targetElement:o,_options:r}=this,{scrollTop:i,scrollHeight:a,clientHeight:l,scrollLeft:h,scrollWidth:d,clientWidth:p}=o,m=this._targetRect,{x1:_,y1:b}=n;let{x2:c,y2:u}=n;const{behaviour:{scrolling:{startScrollMargins:g}}}=r;c<m.left+g.x?(e.x=h?-z(m.left-c+g.x):0,c=c<m.left?m.left:c):c>m.right-g.x?(e.x=d-h-p?z(m.left+m.width-c-g.x):0,c=c>m.right?m.right:c):e.x=0,u<m.top+g.y?(e.y=i?-z(m.top-u+g.y):0,u=u<m.top?m.top:u):u>m.bottom-g.y?(e.y=a-i-l?z(m.top+m.height-u-g.y):0,u=u>m.bottom?m.bottom:u):e.y=0;const v=Ce(_,c),w=Ce(b,u),C=ke(_,c),T=ke(b,u);s.x=v,s.y=w,s.width=C-v,s.height=T-w}_redrawSelectionArea(){const{x:e,y:n,width:s,height:o}=this._areaRect,{style:r}=this._area;r.left=`${e}px`,r.top=`${n}px`,r.width=`${s}px`,r.height=`${o}px`}_onTapStop(e,n){var s;const{document:o,features:r}=this._options,{_singleClick:i}=this;F(o,["mousemove","touchmove"],this._delayedTapMove),F(o,["touchmove","mousemove"],this._onTapMove),F(o,["mouseup","touchcancel","touchend"],this._onTapStop),F(o,"scroll",this._onScroll),this._keepSelection(),e&&i&&r.singleTap.allow?this._onSingleTap(e):!i&&!n&&(this._updateElementSelection(),this._emitEvent("stop",e)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,this._scrollAvailable&&F(o,"wheel",this._manualScroll,{passive:!0}),this._clippingElement.remove(),(s=this._frame)==null||s.cancel(),O(this._area,"display","none")}_updateElementSelection(){const{_selectables:e,_options:n,_selection:s,_areaRect:o}=this,{stored:r,selected:i,touched:a}=s,{intersect:l,overlap:h}=n.behaviour,d=h==="invert",p=[],m=[],_=[];for(let c=0;c<e.length;c++){const u=e[c];if($e(o,u.getBoundingClientRect(),l)){if(i.includes(u))r.includes(u)&&!a.includes(u)&&a.push(u);else if(d&&r.includes(u)){_.push(u);continue}else m.push(u);p.push(u)}}d&&m.push(...r.filter(c=>!i.includes(c)));const b=h==="keep";for(let c=0;c<i.length;c++){const u=i[c];!p.includes(u)&&!(b&&r.includes(u))&&_.push(u)}s.selected=p,s.changed={added:m,removed:_},this._latestElement=p[p.length-1]}_emitEvent(e,n){return this.emit(e,{event:n,store:this._selection,selection:this})}_keepSelection(){const{_options:e,_selection:n}=this,{selected:s,changed:o,touched:r,stored:i}=n,a=s.filter(l=>!i.includes(l));switch(e.behaviour.overlap){case"drop":{n.stored=[...a,...i.filter(l=>!r.includes(l))];break}case"invert":{n.stored=[...a,...i.filter(l=>!o.removed.includes(l))];break}case"keep":{n.stored=[...i,...s.filter(l=>!i.includes(l))];break}}}trigger(e,n=!0){this._onTapStart(e,n)}resolveSelectables(){this._selectables=G(this._options.selectables,this._options.document)}clearSelection(e=!0,n=!1){const{selected:s,stored:o,changed:r}=this._selection;r.added=[],r.removed.push(...s,...e?o:[]),n||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._latestElement=void 0,this._selection={stored:e?[]:o,selected:[],touched:[],changed:{added:[],removed:[]}}}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}cancel(e=!1){this._onTapStop(null,!e)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(e,n=!1){const{changed:s,selected:o,stored:r}=this._selection,i=G(e,this._options.document).filter(a=>!o.includes(a)&&!r.includes(a));return r.push(...i),o.push(...i),s.added.push(...i),s.removed=[],this._latestElement=void 0,n||(this._emitEvent("move",null),this._emitEvent("stop",null)),i}deselect(e,n=!1){const{selected:s,stored:o,changed:r}=this._selection,i=G(e,this._options.document).filter(a=>s.includes(a)||o.includes(a));i.length&&(this._selection.stored=o.filter(a=>!i.includes(a)),this._selection.selected=s.filter(a=>!i.includes(a)),this._selection.changed.added=[],this._selection.changed.removed.push(...i.filter(a=>!r.removed.includes(a))),this._latestElement=void 0,n||(this._emitEvent("move",null),this._emitEvent("stop",null)))}}$(je,"version","3.2.6");/*! @viselect/vue v3.2.6 MIT | https://github.com/Simonwep/selection/tree/master/packages/vue */const yn=W({__name:"SelectionArea",props:{options:null,onBeforeStart:null,onBeforeDrag:null,onStart:null,onMove:null,onStop:null},setup(t,{expose:e}){const n=t,s=k(),o=Qe();return Je(()=>{var r;if(s.value){(r=o.value)==null||r.destroy(),o.value=new je({boundaries:s.value,...n.options});const{onBeforeStart:i,onBeforeDrag:a,onStart:l,onMove:h,onStop:d}=n;i&&o.value.on("beforestart",i),a&&o.value.on("beforedrag",a),l&&o.value.on("start",l),h&&o.value.on("move",h),d&&o.value.on("stop",d)}}),Ke(()=>{var r;(r=o.value)==null||r.destroy()}),e({selection:o}),(r,i)=>(x(),S("div",{ref_key:"container",ref:s},[Ne(r.$slots,"default")],512))}}),wn={id:"canvas-children"},Sn=W({__name:"index",setup(t){const e=k(!1);k(!1),le(()=>e.value=!0);const n=k(null),s=c=>{if(r.value)return;let u=1.05;if(i(c))l(c);else{const g=(c.clientX-f.schemaView.translate.x)/f.schemaView.scale,v=(c.clientY-f.schemaView.translate.y)/f.schemaView.scale;-c.deltaY>0?f.schemaView.scale<=3&&(f.schemaView.scale*=u):f.schemaView.scale>=.5&&(f.schemaView.scale/=u),f.schemaView.translate.x=c.clientX-g*f.schemaView.scale,f.schemaView.translate.y=c.clientY-v*f.schemaView.scale}},o=k(!1),r=k(!1);function i(c){var u=!1;return c.wheelDeltaY?c.wheelDeltaY===c.deltaY*-3&&(u=!0):c.deltaMode===0&&(u=!0),u}const a=c=>{c.which==2&&(o.value=!0,document.onmousemove=l,document.onmouseup=h)},l=c=>{let u=0,g=0;c instanceof WheelEvent?(u=c.deltaX*2,g=c.deltaY*2):(u=c.movementX,g=c.movementY),f.schemaView.translate.x+=u,f.schemaView.translate.y+=g},h=c=>{o.value=!1,document.onmousemove=null,document.onmouseup=null},d=B(()=>`matrix(${f.schemaView.scale},0,0,${f.schemaView.scale},${f.schemaView.translate.x},${f.schemaView.translate.y})`),p=B(()=>"0 0"),m=({event:c,selection:u})=>{const g=c==null?void 0:c.target;if((c==null?void 0:c.which)!=1)return!1;if(g.closest(".selectable"))return!1;f.tableSelected.forEach(v=>{v.classList.remove("selected")}),u.clearSelection(),f.tableSelected.clear()},_=({event:c,selection:u})=>{},b=({event:c,store:{changed:{added:u,removed:g}}})=>{for(const v of u)f.tableSelected.add(v),v.classList.add("selected");for(const v of g)f.tableSelected.delete(v),v.classList.remove("selected")};return le(()=>{localStorage.getItem("url")!=null&&(localStorage.clear(),location.reload())}),(c,u)=>{const g=mn,v=gt;return x(),S("div",{onWheel:u[2]||(u[2]=w=>w.preventDefault())},[D(g),D(E(yn),{class:"container",options:{selectables:"div.selectable"},"on-move":b,"on-start":_,"on-before-start":m},{default:et(()=>[y("div",{id:"screen-canvas",class:"w-screen h-screen relative overflow-hidden bg-white dark:bg-dark-900",style:ue({cursor:o.value?"grabbing":"default"}),onWheel:s,onMousedown:a,onMouseup:u[1]||(u[1]=w=>o.value=!1)},[y("div",{id:"canvas",ref_key:"canvas",ref:n,style:ue({transformOrigin:E(p),transform:E(d)}),class:"absolute select-none relative boxes"},[y("div",wn,[(x(!0),S(Le,null,Me(E(f).tables,w=>(x(),Q(v,{key:w.title,table:w,scale:E(f).schemaView.scale,mounted:e.value,onTableDragging:u[0]||(u[0]=C=>r.value=C)},null,8,["table","scale","mounted"]))),128))])],4)],36)]),_:1},8,["options"])],32)}}});export{Sn as default};
